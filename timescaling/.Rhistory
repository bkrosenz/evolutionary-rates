read.csv(("../data/evorates_preds.csv.gz"))
getwd()
setwd('/N/project/phyloML/rate_timescaling/')
getwd()
read.csv(("data/evorates_preds.csv.gz"))
preds=read.csv(("data/evorates_preds.csv.gz"))
preds
preds$CI
preds %>% filter(~is.na(CI))
dplyr
require(dplyr)
preds %>% filter(~is.na(CI))
preds %>% filter(!is.na(CI))
p=preds %>% filter(!is.na(CI))
p
algnames
.Primitive("c")
algnames =  c('EB','rate_trend','delta')
setwd('/N/project/phyloML/rate_timescaling/evorates')
# invocation:
# parallel -j2 Rscript estimate_rates.R  {} 8  ::: `find /N/project/phyloML/rate_timescaling/data/tree_sims/ -name 'h*' -type d -maxdepth 3` ::: rate_trend EB delta BM
#### parameters
require(tidyverse)
# require(crunch)
require(zeallot)
library(rlist)
library(dplyr)
library('ggplot2')
for (m in algnames ){
cor_mat = predictions%>% filter(model==m) %>% drop_na(sig) %>% select(!model) %>% as.matrix %>%
cor(method="spearman") %>%
as.data.frame
print(m)
print(cor_mat)
d = predictions %>% filter(model==m)
print(mean(d$sig,na.rm=T))
ggplot(predictions %>% filter(model==m),
aes(sig,fill=as.factor(model))) + geom_histogram() + scale_x_log10()
# ggplot(predictions,aes(x=sig,fill =as.factor(model) )) + geom_histogram() + scale_x_log10()
}
for (m in algnames ){
ggplot(p%>% filter(model==m))+aes(x=hr,y=CI,fill=as.factor(model))+geom_point()
}
ggsave('../figures/timescaling/ci.png')
for (m in algnames ){
ggplot(p%>% filter(model==m))+aes(x=hr,y=CI,fill=as.factor(model))+geom_point()
}
1
ggplot(p)+aes(x=hr,y=CI,fill=as.factor(model))+geom_point()
for (m in algnames ){
cor_mat = predictions%>% filter(model==m) %>% drop_na(sig) %>% select(!model) %>% as.matrix %>%
cor(method="spearman") %>%
as.data.frame
print(m)
print(cor_mat)
d = predictions %>% filter(model==m)
print(mean(d$sig,na.rm=T))}
predictions=p
for (m in algnames ){
cor_mat = predictions%>% filter(model==m) %>% drop_na(sig) %>% select(!model) %>% as.matrix %>%
cor(method="spearman") %>%
as.data.frame
print(m)
print(cor_mat)
d = predictions %>% filter(model==m)
print(mean(d$sig,na.rm=T))}
p%>% group_by(model,hr)%>%group_map(mean)
p%>% group_by(model,hr)%>%mean
mean
na.mean
p
p%>% group_by(model,hr)%>%select(CI)%>%group_map(mean)
p%>% group_by(model,hr)%>%group_map(mean(.CI))
p%>% group_by(model,hr)%>%summarise(mean(CI))
ci=p%>% group_by(model,hr)%>%group_map(mean(.CI))
cp=p%>% group_by(model,hr)%>%summarise(mean(CI))
cp
cp=p%>% group_by(model,hr)%>%summarise(EI_CI=mean(CI))
cp
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()
ip = preds %>% filter(!is.na(accelerating)) %>% group_by(model,hr)%>%summarise(EI = mean(accelerating))
,color=as.factor(model))+geom_point()
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point()
corr
for (m in algnames ){
cor_mat = predictions%>% filter(model==m) %>% drop_na(sig) %>% select(!model) %>% as.matrix %>%
cor(method="spearman") %>%
as.data.frame
print(m)
print(cor_mat)
d = predictions %>% filter(model==m)
print(mean(d$sig,na.rm=T))
ggplot(predictions %>% filter(model==m),
aes(sig,fill=as.factor(model))) + geom_histogram() + scale_x_log10()
# ggplot(predictions,aes(x=sig,fill =as.factor(model) )) + geom_histogram() + scale_x_log10()
}
ggplot(ip%>%filter(model==m))+aes(x=hr,y=EI,color=as.factor(model))+geom_point()
for (m in algnames ){
ggplot(ip%>%filter(model==m))+aes(x=hr,y=EI,color=as.factor(model))+geom_point()
}
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) +      guides(color = guide_legend(title = "Model"))
map <- c("delta" = "Delta", "EB" = "ACDC", "rate_trend" = "LT")
preds$model=map[preds$model]
cp = preds %>% filter(!is.na(CI)) %>% group_by(model,hr)%>%summarise(EI_CI=mean(CI))
ggplot(cp)+aes(x=hr,y=EI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression(EI_{CI})) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI_{CI}')) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI['['CI']']')) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI['['CI']*']')) +      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) +      guides(color = guide_legend(title = "Model"))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) +      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/accel.png')
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/ci.png')
preds
cp = preds %>% filter(!is.na(CI)) %>% group_by(model,hr)%>%summarise(EI_CI=mean(CI))
ip = preds %>% filter(!is.na(accelerating)) %>% group_by(model,hr)%>%summarise(EI = mean(accelerating))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) +      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/accel.png')
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/ci.png')
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) + guides(fill="none")# +      guides(color = guide_legend(title = "Model"))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) + theme(legend.position="none") #+      guides(color = guide_legend(title = "Model"))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI))# + theme(legend.position="none") #+      guides(color = guide_legend(title = "Model"))
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggplot(ip)+aes(x=hr,y=EI,color=as.factor(model))+geom_point() + labs(x = 'Hr',y=expression(EI)) + theme(legend.position="none") #+      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/accel.png')
ggplot(cp)+aes(x=hr,y=EI_CI,color=as.factor(model))+geom_point()+ labs(x = 'Hr',y=expression('EI'['CI'])) +      guides(color = guide_legend(title = "Model"))
ggsave('../figures/timescaling/ci.png')
